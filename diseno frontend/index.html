<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>PLATAFORMA DE CRIPTOMONEDAS</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i" rel="stylesheet" />
    <link href="css/styles.css" rel="stylesheet" />
    <style>
        /* Estilos existentes para formularios */
        #registrationForm, #logInForm, #forgotPasswordForm, .dropdown-menu {
            background-color: #f8f9fa;
            padding: 15px;
            margin: 200px auto;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(235, 212, 4, 0.1);
            max-width: 400px;
            z-index: 1000;
            display: none;
        }

        #depositFundsSection {
            display: none;
            position: relative;
            top: 2px;
            background-color: #f8f9fa;
            padding: 15px;
            margin: 350px auto;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(223, 0, 0, 0.1);
            max-width: 400px;
            z-index: 1000;
        }

        /* Estilo para el formulario de soporte */
        #supportForm {
            background-color: #f8f9fa;
            padding: 15px;
            margin: 200px auto;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.1); /* Sombra azul para diferenciar */
            max-width: 400px;
            z-index: 1000;
            display: none; /* Ocultamos el formulario al inicio */
        }

        /* Nuevo estilo para el formulario de compra y venta */
        #cryptoTradeSection {
            background-color: #f8f9fa;
            padding: 15px;
            margin: 200px auto;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(40, 167, 69, 0.1); /* Sombra verde */
            max-width: 400px;
            z-index: 1000;
            display: none; /* Ocultamos el formulario al inicio */
        }

        #miPortafolio {
            margin-top: 50px;
        }

        .dropdown-menu {
            margin-top: 5px;
            left: auto;
            position: absolute;
            display: none;
            z-index: 1050;
        }

        .dropdown-menu a {
            display: block;
            padding: 8px 12px;
            text-decoration: none;
            color: #333;
            border-bottom: 1px solid #eee;
        }

        .dropdown-menu a:last-child {
            border-bottom: none;
        }

        .dropdown-menu a:hover {
            background-color: #e9ecef;
        }

        #registrationForm label, #logInForm label, #forgotPasswordForm label, #supportForm label, #cryptoTradeSection label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        #registrationForm input[type="email"],
        #registrationForm input[type="password"],
        #logInForm input[type="email"],
        #logInForm input[type="password"],
        #forgotPasswordForm input[type="email"],
        #supportForm input[type="email"],
        #supportForm input[type="text"],
        #supportForm textarea,
        #cryptoTradeSection input[type="number"],
        #cryptoTradeSection select
        {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            box-sizing: border-box;
        }

        #registrationForm button, #forgotPasswordForm button, #supportForm button, #cryptoTradeSection button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin-right: 20px;
        }

        #registrationForm button:hover, #forgotPasswordForm button:hover, #supportForm button:hover, #cryptoTradeSection button:hover {
            background-color: #0056b3;
        }

        .form-navigation {
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .form-navigation a {
            color: #007bff;
            text-decoration: none;
        }

        .form-navigation a:hover {
            text-decoration: underline;
        }

        .is-invalid {
            border-color: red;
        }

        #mainContent {
            display: block;
        }

        .navbar-custom {
            background-color: #101019 !important;
            z-index: 1100;
        }

        #viewPortfolioButton {
            background-color: #493696 !important;
            color: #FFFFFF !important;
            border-color: #000000 !important;
        }

        #viewPortfolioButton:hover {
            background-color: #322565 !important;
            border-color: #000000 !important;
        }
    </style>
</head>
<body id="page-top">
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top">
        <div class="container px-5">
            <a class="navbar-brand" href="#page-top"></a>
            <a class="nav-link text-white ms-3" href="#page-top">INICIO</a>
            <div class="nav-item dropdown" id="portafolioNav">
                <a class="nav-link text-white ms-3" href="#" id="portafolioButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">PORTAFOLIO DE USUARIO</a>
                <div class="dropdown-menu" aria-labelledby="portafolioButton" id="portafolioDropdown">
                    <a class="dropdown-item" href="#miPortafolio" id="viewPortfolioLink">Portafolio</a>
                    <a class="dropdown-item" href="#" id="goToDepositLink">Depósito</a>
                </div>
            </div>
            <div class="nav-item dropdown" id="depositoNav">
                <a class="nav-link text-white ms-3" href="#" id="depositoButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">DEPÓSITO DE FONDOS</a>
                <div class="dropdown-menu" aria-labelledby="depositoButton" id="depositoDropdown">
                    <a class="dropdown-item" href="#" id="showDepositFormLink">Realizar Depósito</a>
                </div>
            </div>
            <div class="nav-item dropdown" id="cryptoTradeNav">
                <a class="nav-link text-white ms-3" href="#" id="cryptoTradeButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">COMPRA Y VENTA</a>
                <div class="dropdown-menu" aria-labelledby="cryptoTradeButton" id="cryptoTradeDropdown">
                    <a class="dropdown-item" href="#" id="showCryptoTradeFormLink">Operar Criptomonedas</a>
                </div>
            </div>
            <div class="nav-item dropdown" id="supportNav">
                <a class="nav-link text-white ms-3" href="#" id="supportButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">SOPORTE</a>
                <div class="dropdown-menu" aria-labelledby="supportButton" id="supportDropdown">
                    <a class="dropdown-item" href="#" id="showSupportFormNavLink">Contactar Soporte</a>
                </div>
            </div>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto">
                    <div class="nav-item dropdown">
                        <a class="nav-link text-white ms-3" href="#" id="userSessionButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Inicio de Sesión</a>
                        <div class="dropdown-menu" aria-labelledby="userSessionButton" id="userSessionDropdown">
                            <a class="dropdown-item" href="#" id="registerOption">Registro</a>
                            <a class="dropdown-item" href="#" id="logInOption">Iniciar Sesión</a>
                            <a class="dropdown-item" href="#" id="logOutOption" style="display: none;">Cerrar Sesión</a>
                        </div>
                    </div>
                </ul>
            </div>
        </div>
    </nav>

    <div id="mainContent">
        <header class="masthead text-center text-white" style="padding-bottom: 100px;">
            <div class="masthead-content">
                <div class="container px-5">
                    <h1 class="masthead-heading mb-0">Plataforma de Criptomonedas</h1>
                    <h2 class="masthead-subheading mb-0">Gestiona y haz crecer tus activos digitales.</h2>
                    <a class="btn btn-primary btn-xl rounded-pill mt-5" href="#miPortafolio" id="viewPortfolioButton">Ver Portafolio</a>
                </div>
            </div>
        </header>
    </div>

    <div id="registrationForm">
        <h2>Registro de Usuario</h2>
        <form id="registerForm">
            <label for="email">Correo Electrónico:</label>
            <input type="email" id="email" class="form-control" placeholder="Correo Electrónico" required>
            <label for="password">Contraseña:</label>
            <input type="password" id="password" class="form-control" placeholder="Contraseña" required>
            <label for="confirmPassword">Confirmar Contraseña:</label>
           <input type="password" id="confirmPassword" class="form-control" placeholder="Confirmar Contraseña">
            <button type="submit">Registrarse</button>
            <button type="button" id="goBack">Volver</button>
        </form>
        <div class="form-navigation">
            ¿Ya tienes una cuenta? <a href="#" id="toggleLogIn">Iniciar Sesión</a>
        </div>
    </div>

    <div id="logInForm">
        <h2>Iniciar Sesión</h2>
        <form id="loginForm">
            <label for="loginEmail">Correo Electrónico:</label>
            <input type="email" id="loginEmail" name="loginEmail" required>
            <label for="loginPassword">Contraseña:</label>
            <input type="password" id="loginPassword" name="loginPassword" required>
            <button type="submit">Iniciar Sesión</button>
            <button type="button" id="goBackFromLogin">Volver</button>
        </form>
        <div class="form-navigation">
            <a href="#" id="forgotPasswordLink">¿Olvidaste tu contraseña?</a> <br>
            ¿No tienes una cuenta? <a href="#" id="toggleRegister">Registrarse</a>
        </div>
    </div>

    <div id="forgotPasswordForm">
        <h2>Restablecer Contraseña</h2>
        <form id="resetPasswordForm">
            <p>Introduce tu correo electrónico para enviarte un enlace de restablecimiento de contraseña.</p>
            <label for="resetEmail">Correo Electrónico:</label>
            <input type="email" id="resetEmail" name="resetEmail" required>
            <button type="submit">Restablecer contraseña</button>
            <button type="button" id="goBackFromReset">Volver</button>
        </form>
    </div>

    <section id="miPortafolio" class="py-5" style="display: none; margin-top: 100px;">
        <div class="container px-5">
            <h2 class="display-4 mb-4">MI PORTAFOLIO</h2>
            <div class="card shadow border-0 rounded-lg mb-5">
                <div class="card-body py-5 px-md-5">
                    <div class="mb-4">
                        <h3>Valor Total del Portafolio</h3>
                        <p class="lead">$ [Valor Total en USD]</p>
                        <small class="text-muted">El valor en tu moneda local se mostrará aquí.</small>
                    </div>
                    <div>
                        <h3>Tus Criptomonedas</h3>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Símbolo</th>
                                        <th>Cantidad</th>
                                        <th>Valor Unitario</th>
                                        <th>Valor Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Bitcoin</td>
                                        <td>BTC</td>
                                        <td>0.5</td>
                                        <td>[Precio de BTC]</td>
                                        <td>[Valor de 0.5 BTC]</td>
                                    </tr>
                                    <tr>
                                        <td>Ethereum</td>
                                        <td>ETH</td>
                                        <td>2.0</td>
                                        <td>[Precio de ETH]</td>
                                        <td>[Valor de 2.0 ETH]</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="depositFundsSection">
        <h2>DEPOSITAR FONDOS</h2>
        <div class="formulario">
            <form id="depositForm">
                <label for="metodo">Método de Depósito:</label>
                <select id="metodo">
                    <option value="tarjeta">Tarjeta de Crédito</option>
                    <option value="transferencia">Transferencia Bancaria</option>
                    <option value="cripto">Criptomoneda</option>
                </select>
                <label for="monto">Monto a Depositar (USD):</label>
                <input type="number" id="monto" required>
                <button type="submit">Depositar</button>
                <button type="button" id="goBackToMain">Volver</button>
            </form>
        </div>
    </section>

    <div id="cryptoTradeSection">
        <h2>Compra y Venta de Criptomonedas</h2>
        <form id="cryptoTradeForm">
            <label for="cryptoSelect">Seleccionar Criptomoneda:</label>
            <select id="cryptoSelect">
                <option value="BTC">Bitcoin (BTC)</option>
                <option value="ETH">Ethereum (ETH)</option>
                <option value="USDT">Tether (USDT)</option>
                <option value="XRP">Ripple (XRP)</option>
            </select>

            <label for="tradeType">Tipo de Operación:</label>
            <select id="tradeType">
                <option value="buy">Comprar</option>
                <option value="sell">Vender</option>
            </select>

            <label for="tradeAmount">Cantidad:</label>
            <input type="number" id="tradeAmount" step="any" min="0.00000001" required>

            <label for="orderType">Tipo de Orden:</label>
            <select id="orderType">
                <option value="market">Mercado</option>
                <option value="limit">Límite</option>
            </select>
            <div id="limitPriceContainer" style="display: none;">
                <label for="limitPrice">Precio Límite (USD):</label>
                <input type="number" id="limitPrice" step="any" min="0.01">
            </div>

            <button type="submit" id="executeTradeButton">Confirmar Operación</button>
            <button type="button" id="goBackFromCryptoTrade">Volver</button>
        </form>
    </div>

    <div id="supportForm">
        <h2>Soporte Técnico</h2>
        <form id="contactSupportForm">
            <p>Por favor, describe tu problema o consulta. Te responderemos a la brevedad.</p>
            <label for="supportEmail">Tu Correo Electrónico:</label>
            <input type="email" id="supportEmail" name="supportEmail" required>

            <label for="supportSubject">Asunto:</label>
            <input type="text" id="supportSubject" name="supportSubject" required>

            <label for="supportMessage">Mensaje:</label>
            <textarea id="supportMessage" name="supportMessage" rows="5" required></textarea>

            <button type="submit">Enviar Mensaje</button>
            <button type="button" id="goBackFromSupport">Volver</button>
        </form>
    </div>

    <footer class="bg-dark py-5">
        <div class="container px-5">
            <p class="m-0 text-center text-white">Plataforma de Criptomonedas &copy; 2025</p>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const userSessionButton = document.getElementById('userSessionButton');
            const userSessionDropdown = document.getElementById('userSessionDropdown');
            const registerOption = document.getElementById('registerOption');
            const logInOption = document.getElementById('logInOption');
            const logOutOption = document.getElementById('logOutOption');
            const registrationForm = document.getElementById('registrationForm');
            const logInForm = document.getElementById('logInForm');
            const forgotPasswordForm = document.getElementById('forgotPasswordForm');
            const mainContent = document.getElementById('mainContent');
            const inicioButton = document.querySelector('.navbar-brand + .nav-link');
            const toggleLogInLink = document.getElementById('toggleLogIn');
            const toggleRegisterLink = document.getElementById('toggleRegister');
            const forgotPasswordLink = document.getElementById('forgotPasswordLink');
            const resetPasswordForm = document.getElementById('resetPasswordForm');
            const goBackFromResetButton = document.getElementById('goBackFromReset');
            const registerForm = document.getElementById('registerForm');
            const loginForm = document.getElementById('loginForm');

            // --- Elementos de Navegación ---
            const portafolioNav = document.getElementById('portafolioNav');
            const portafolioButton = document.getElementById('portafolioButton');
            const portafolioDropdown = document.getElementById('portafolioDropdown');
            const viewPortfolioButton = document.getElementById('viewPortfolioButton');
            const viewPortfolioLink = document.getElementById('viewPortfolioLink');
            const portfolioSection = document.getElementById('miPortafolio');
            const goToDepositLink = document.getElementById('goToDepositLink');

            const depositoNav = document.getElementById('depositoNav');
            const depositoButton = document.getElementById('depositoButton');
            const depositoDropdown = document.getElementById('depositoDropdown');
            const showDepositFormLink = document.getElementById('showDepositFormLink');
            const depositFundsSection = document.getElementById('depositFundsSection');
            const depositForm = document.getElementById('depositForm');
            const montoInput = document.getElementById('monto');
            const goBackToMainButton = document.getElementById('goBackToMain');

            const cryptoTradeNav = document.getElementById('cryptoTradeNav');
            const cryptoTradeButton = document.getElementById('cryptoTradeButton');
            const cryptoTradeDropdown = document.getElementById('cryptoTradeDropdown');
            const showCryptoTradeFormLink = document.getElementById('showCryptoTradeFormLink');
            const cryptoTradeSection = document.getElementById('cryptoTradeSection');
            const cryptoTradeForm = document.getElementById('cryptoTradeForm');
            const goBackFromCryptoTradeButton = document.getElementById('goBackFromCryptoTrade');
            const cryptoSelect = document.getElementById('cryptoSelect');
            const tradeType = document.getElementById('tradeType');
            const tradeAmount = document.getElementById('tradeAmount');
            const orderType = document.getElementById('orderType');
            const limitPriceContainer = document.getElementById('limitPriceContainer');
            const limitPrice = document.getElementById('limitPrice');

            const supportNav = document.getElementById('supportNav');
            const supportButton = document.getElementById('supportButton');
            const supportDropdown = document.getElementById('supportDropdown');
            const showSupportFormNavLink = document.getElementById('showSupportFormNavLink');
            const supportForm = document.getElementById('supportForm');
            const goBackFromSupportButton = document.getElementById('goBackFromSupport');
            const contactSupportForm = document.getElementById('contactSupportForm');
            // -------------------------------------------------------------

            const goBackButton = document.getElementById('goBack');
            const goBackFromLoginButton = document.getElementById('goBackFromLogin');


            let isLoggedIn = false; // Estado inicial de la sesión

            function hideAllForms() {
                registrationForm.style.display = 'none';
                logInForm.style.display = 'none';
                forgotPasswordForm.style.display = 'none';
                mainContent.style.display = 'none';
                portfolioSection.style.display = 'none';
                depositFundsSection.style.display = 'none';
                supportForm.style.display = 'none';
                cryptoTradeSection.style.display = 'none';
            }

            function closeAllDropdowns() {
                userSessionDropdown.style.display = 'none';
                portafolioDropdown.style.display = 'none';
                depositoDropdown.style.display = 'none';
                cryptoTradeDropdown.style.display = 'none';
                supportDropdown.style.display = 'none';
            }

            function showMainContent() {
                hideAllForms();
                mainContent.style.display = 'block';
                closeAllDropdowns(); // Asegúrate de que los dropdowns se cierren al volver a la página principal
            }

            function showRegistrationForm() {
                hideAllForms();
                registrationForm.style.display = 'block';
                closeAllDropdowns();
            }

            function showLogInForm() {
                hideAllForms();
                logInForm.style.display = 'block';
                closeAllDropdowns();
            }

            function showForgotPasswordForm() {
                hideAllForms();
                forgotPasswordForm.style.display = 'block';
                closeAllDropdowns();
            }

            function showDepositFundsSection() {
                hideAllForms();
                depositFundsSection.style.display = 'block';
                closeAllDropdowns();
            }

            function showSupportForm() {
                hideAllForms();
                supportForm.style.display = 'block';
                closeAllDropdowns();
            }

            function showCryptoTradeSection() {
                hideAllForms();
                cryptoTradeSection.style.display = 'block';
                closeAllDropdowns();
                // Asegurarse de que el campo de precio límite esté oculto por defecto
                // si la opción inicial es 'market'
                if (orderType.value === 'market') {
                    limitPriceContainer.style.display = 'none';
                    limitPrice.removeAttribute('required');
                } else {
                    limitPriceContainer.style.display = 'block'; // En caso de que se cambie la opción antes de abrir
                    limitPrice.setAttribute('required', 'required');
                }
            }

            // Función para actualizar la visibilidad de los elementos de navegación
            // Todos los elementos de navegación son siempre visibles.
            // La lógica de acceso se maneja en los event listeners.
            function updateNavVisibility() {
                // Aseguramos que todos los elementos de navegación estén visibles
                portafolioNav.style.display = 'block';
                depositoNav.style.display = 'block';
                cryptoTradeNav.style.display = 'block';
                supportNav.style.display = 'block';

                // El botón "Ver Portafolio" en el área principal solo es visible si se ha iniciado sesión
                if (isLoggedIn) {
                    viewPortfolioButton.style.display = 'inline-block';
                    logOutOption.style.display = 'block'; // Mostrar opción de cerrar sesión
                    logInOption.style.display = 'none';    // Ocultar opción de iniciar sesión
                    registerOption.style.display = 'none'; // Ocultar opción de registro
                    userSessionButton.textContent = 'Mi Cuenta'; // Cambiar texto del botón de sesión
                } else {
                    viewPortfolioButton.style.display = 'none';
                    logOutOption.style.display = 'none';   // Ocultar opción de cerrar sesión
                    logInOption.style.display = 'block';   // Mostrar opción de iniciar sesión
                    registerOption.style.display = 'block'; // Mostrar opción de registro
                    userSessionButton.textContent = 'Inicio de Sesión'; // Restaurar texto del botón de sesión
                }
            }


            // --- Event Listeners para controlar el acceso a las funciones protegidas ---

            viewPortfolioButton.addEventListener('click', function(event) {
                event.preventDefault();
                if (!isLoggedIn) {
                    alert('Debes iniciar sesión para acceder a tu portafolio y ver tus activos.');
                    return;
                }
                hideAllForms();
                portfolioSection.style.display = 'block';
                portfolioSection.scrollIntoView({ behavior: 'smooth' });
            });

            // PORTAFOLIO DE USUARIO (botón principal en la navbar)
            portafolioButton.addEventListener('click', function(event) {
                event.preventDefault();
                if (!isLoggedIn) {
                    alert('Debes iniciar sesión para ver tu portafolio y sus opciones.');
                    closeAllDropdowns(); // Asegura que el dropdown no se abra si no está logueado
                    return;
                }
                // Si está logueado, procede a mostrar/ocultar el dropdown
                portafolioDropdown.style.display = (portafolioDropdown.style.display === 'block') ? 'none' : 'block';
                // Cierra otros dropdowns
                userSessionDropdown.style.display = 'none';
                depositoDropdown.style.display = 'none';
                cryptoTradeDropdown.style.display = 'none';
                supportDropdown.style.display = 'none';
                hideAllForms(); // Oculta otros formularios
                mainContent.style.display = 'block'; // Asegura que el contenido principal sea visible detrás del dropdown
            });

            // Enlace "Portafolio" dentro del dropdown de Portafolio
            viewPortfolioLink.addEventListener('click', function(event) {
                event.preventDefault();
                if (!isLoggedIn) {
                    alert('Debes iniciar sesión para acceder a tu portafolio y ver tus activos.');
                    return;
                }
                hideAllForms();
                portfolioSection.style.display = 'block';
                portfolioSection.scrollIntoView({ behavior: 'smooth' });
                closeAllDropdowns();
            });

            // Enlace "Depósito" dentro del dropdown de Portafolio
            goToDepositLink.addEventListener('click', function(event) {
                event.preventDefault();
                if (!isLoggedIn) {
                    alert('Debes iniciar sesión para poder realizar un depósito de fondos.');
                    return;
                }
                showDepositFundsSection();
            });

            // DEPÓSITO DE FONDOS (botón principal en la navbar)
            depositoButton.addEventListener('click', function(event) {
                event.preventDefault();
                if (!isLoggedIn) {
                    alert('Debes iniciar sesión para acceder a las opciones de depósito de fondos.');
                    closeAllDropdowns(); // Asegura que el dropdown no se abra si no está logueado
                    return;
                }
                depositoDropdown.style.display = (depositoDropdown.style.display === 'block') ? 'none' : 'block';
                // Cierra otros dropdowns
                userSessionDropdown.style.display = 'none';
                portafolioDropdown.style.display = 'none';
                cryptoTradeDropdown.style.display = 'none';
                supportDropdown.style.display = 'none';
                hideAllForms();
                mainContent.style.display = 'block';
            });

            // Enlace "Realizar Depósito" dentro del dropdown de Depósito
            showDepositFormLink.addEventListener('click', function(event) {
                event.preventDefault();
                if (!isLoggedIn) {
                    alert('Debes iniciar sesión para poder realizar un depósito de fondos.');
                    return;
                }
                showDepositFundsSection();
            });

            // COMPRA Y VENTA (botón principal en la navbar)
            cryptoTradeButton.addEventListener('click', function(event) {
                event.preventDefault();
                if (!isLoggedIn) {
                    alert('Debes iniciar sesión para operar con criptomonedas (comprar y vender).');
                    closeAllDropdowns(); // Asegura que el dropdown no se abra si no está logueado
                    return;
                }
                cryptoTradeDropdown.style.display = (cryptoTradeDropdown.style.display === 'block') ? 'none' : 'block';
                // Cierra otros dropdowns
                userSessionDropdown.style.display = 'none';
                portafolioDropdown.style.display = 'none';
                depositoDropdown.style.display = 'none';
                supportDropdown.style.display = 'none';
                hideAllForms();
                mainContent.style.display = 'block';
            });

            // Enlace "Operar Criptomonedas" dentro del dropdown de Compra y Venta
            showCryptoTradeFormLink.addEventListener('click', function(event) {
                event.preventDefault();
                if (!isLoggedIn) {
                    alert('Debes iniciar sesión para poder operar con criptomonedas.');
                    return;
                }
                showCryptoTradeSection();
            });

            // SOPORTE (botón principal en la navbar) - SIEMPRE ACCESIBLE
            supportButton.addEventListener('click', function(event) {
                event.preventDefault();
                supportDropdown.style.display = (supportDropdown.style.display === 'block') ? 'none' : 'block';
                closeAllDropdownsExcept(supportDropdown); // Cierra los demás dropdowns
                hideAllForms();
                mainContent.style.display = 'block';
            });

            // Enlace "Contactar Soporte" dentro del dropdown de Soporte - SIEMPRE ACCESIBLE
            showSupportFormNavLink.addEventListener('click', function(event) {
                event.preventDefault();
                showSupportForm();
            });

            // --- FIN de Event Listeners para funciones protegidas ---

            registerForm.addEventListener('submit', function(event) {
    event.preventDefault();
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const email = emailInput.value.trim();
    const password = passwordInput.value;
    const confirmPassword = confirmPasswordInput.value;

    let isValid = true;
    let errorMessage = "";

    // Validación de email
    if (!/\S+@\S+\.\S+/.test(email)) {
        isValid = false;
        errorMessage += "Por favor, introduce un correo electrónico válido.\n";
        emailInput.classList.add('is-invalid');
    } else {
        emailInput.classList.remove('is-invalid');
    }

    // Validación de contraseña vacía
    if (password.trim() === "") {
        isValid = false;
        errorMessage += "La contraseña no puede estar vacía.\n";
        passwordInput.classList.add('is-invalid');
    } else {
        passwordInput.classList.remove('is-invalid');
    }

    // *** NUEVA VALIDACIÓN: Longitud mínima de la contraseña ***
    // Se ejecuta solo si la contraseña no estaba vacía
    if (password.length < 6) { // Puedes cambiar '6' por la longitud mínima que desees
        isValid = false;
        errorMessage += "La contraseña debe tener al menos 6 caracteres.\n";
        passwordInput.classList.add('is-invalid');
    } 
    // No añadir un 'else' aquí para quitar 'is-invalid' si ya se añadió por password.trim() === ""
    // La eliminación de 'is-invalid' para passwordInput se maneja en el else de password.trim() === ""
    // Si la contraseña no está vacía y es de longitud correcta, el 'is-invalid' ya se habría quitado.


    // Validación de confirmación de contraseña (que coincidan)
    if (password !== confirmPassword) {
        isValid = false;
        errorMessage += "Las contraseñas no coinciden.\n";
        confirmPasswordInput.classList.add('is-invalid');
    } else {
        // Asegúrate de remover la clase is-invalid si coinciden
        confirmPasswordInput.classList.remove('is-invalid');
    }

    // Lógica final para mostrar alertas o proceder al registro
    if (isValid) {
        alert('Registro exitoso. ¡Bienvenido a nuestra plataforma!');
        isLoggedIn = true; // Iniciar sesión automáticamente después del registro
        showMainContent(); // Volver al contenido principal
        updateNavVisibility(); // Actualizar la barra de navegación (mostrar "Mi Cuenta", "Cerrar Sesión", etc.)
        registerForm.reset(); // Limpiar formulario de registro
    } else {
        alert(errorMessage);
    }
});

            loginForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const loginEmailInput = document.getElementById('loginEmail');
                const loginPasswordInput = document.getElementById('loginPassword');
                const loginEmail = loginEmailInput.value.trim();
                const loginPassword = loginPasswordInput.value;

                // Simulacion de login
                if (loginEmail === "test@example.com" && loginPassword === "password") {
                    alert('¡Inicio de sesión exitoso! Bienvenido de nuevo.');
                    isLoggedIn = true;
                    showMainContent();
                    updateNavVisibility(); // Actualiza la visibilidad de los elementos de navegación
                    loginForm.reset(); // Limpiar formulario de login
                } else {
                    alert('Credenciales incorrectas. Por favor, verifica tu correo y contraseña.');
                    loginEmailInput.classList.add('is-invalid');
                    loginPasswordInput.classList.add('is-invalid');
                }
            });

            resetPasswordForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const resetEmailInput = document.getElementById('resetEmail');
                const resetEmail = resetEmailInput.value.trim();

                if (!/\S+@\S+\.\S+/.test(resetEmail)) {
                    alert('Por favor, introduce un correo electrónico válido.');
                    resetEmailInput.classList.add('is-invalid');
                    return;
                } else {
                    resetEmailInput.classList.remove('is-invalid');
                }

                alert(`Se ha enviado un enlace de restablecimiento a ${resetEmail}. Por favor, revisa tu bandeja de entrada.`);
                showLogInForm();
            });

            contactSupportForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const supportEmail = document.getElementById('supportEmail').value.trim();
                const supportSubject = document.getElementById('supportSubject').value.trim();
                const supportMessage = document.getElementById('supportMessage').value.trim();

                if (supportEmail && supportSubject && supportMessage) {
                    alert('Tu mensaje ha sido enviado al equipo de soporte. Te responderemos pronto.');
                    contactSupportForm.reset();
                    showMainContent();
                } else {
                    alert('Por favor, completa todos los campos del formulario de soporte.');
                }
            });

            cryptoTradeForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const crypto = cryptoSelect.value;
                const type = tradeType.value;
                const amount = parseFloat(tradeAmount.value);
                const order = orderType.value;
                const price = (order === 'limit') ? parseFloat(limitPrice.value) : null;

                if (isNaN(amount) || amount <= 0) {
                    alert('Por favor, ingresa una cantidad válida.');
                    return;
                }
                if (order === 'limit' && (isNaN(price) || price <= 0)) {
                    alert('Por favor, ingresa un precio límite válido.');
                    return;
                }

                // Simulación de validaciones de fondos/cantidad
                if (type === 'buy' && amount * 1000 > 50000) { // Ejemplo: si la compra es "grande"
                    alert('Fondos insuficientes o límite de compra excedido.');
                } else if (type === 'sell' && amount > 10) { // Ejemplo: si la venta es "grande"
                    alert('Cantidad de criptomoneda insuficiente para vender.');
                } else {
                    alert(`Operación de ${type === 'buy' ? 'compra' : 'venta'} de ${amount} ${crypto} (${order} order) realizada con éxito.`);
                    cryptoTradeForm.reset();
                    // Restablecer el tipo de orden a "Mercado" y ocultar el precio límite al limpiar el formulario
                    orderType.value = 'market';
                    limitPriceContainer.style.display = 'none';
                    limitPrice.removeAttribute('required');
                    showMainContent();
                }
            });

            // Mostrar/ocultar campo de precio límite
            orderType.addEventListener('change', function() {
                if (orderType.value === 'limit') {
                    limitPriceContainer.style.display = 'block';
                    limitPrice.setAttribute('required', 'required');
                } else {
                    limitPriceContainer.style.display = 'none';
                    limitPrice.removeAttribute('required');
                }
            });

            userSessionButton.addEventListener('click', function(event) {
                event.preventDefault();
                userSessionDropdown.style.display = (userSessionDropdown.style.display === 'block') ? 'none' : 'block';
                closeAllDropdownsExcept(userSessionDropdown); // Cierra los demás dropdowns
            });

            registerOption.addEventListener('click', function(event) {
                event.preventDefault();
                showRegistrationForm();
            });

            logInOption.addEventListener('click', function(event) {
                event.preventDefault();
                showLogInForm();
            });

            logOutOption.addEventListener('click', function(event) {
                event.preventDefault();
                isLoggedIn = false;
                showMainContent();
                updateNavVisibility(); // Actualiza la visibilidad de los elementos de navegación
                alert('Sesión cerrada correctamente. ¡Esperamos verte pronto!');
            });

            inicioButton.addEventListener('click', function(event) {
                event.preventDefault();
                showMainContent();
            });

            toggleLogInLink.addEventListener('click', function(event) {
                event.preventDefault();
                showLogInForm();
            });

            toggleRegisterLink.addEventListener('click', function(event) {
                event.preventDefault();
                showRegistrationForm();
            });

            forgotPasswordLink.addEventListener('click', function(event) {
                event.preventDefault();
                showForgotPasswordForm();
            });

            goBackFromResetButton.addEventListener('click', function() {
                showLogInForm();
            });

            goBackFromLoginButton.addEventListener('click', function() {
                showMainContent();
            });

            depositForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const monto = parseFloat(montoInput.value);

                if (isNaN(monto) || monto <= 0) {
                    alert('Por favor, ingrese un monto válido mayor que cero.');
                    return;
                }
                alert(`Depósito de $${monto.toFixed(2)} realizado con éxito.`);
                depositForm.reset();
                showMainContent();
            });


            goBackToMainButton.addEventListener('click', function() {
                showMainContent();
            });

            goBackFromSupportButton.addEventListener('click', function() {
                showMainContent();
            });

            goBackFromCryptoTradeButton.addEventListener('click', function() {
                showMainContent();
            });

            goBackButton.addEventListener('click', function() {
                showMainContent();
            });

            // Función auxiliar para cerrar todos los dropdowns excepto uno (opcional)
            function closeAllDropdownsExcept(excludedDropdown) {
                const allDropdowns = [userSessionDropdown, portafolioDropdown, depositoDropdown, cryptoTradeDropdown, supportDropdown];
                allDropdowns.forEach(dropdown => {
                    if (dropdown !== excludedDropdown) {
                        dropdown.style.display = 'none';
                    }
                });
            }

            // Cierra los dropdowns si se hace clic fuera
            document.addEventListener('click', function(event) {
                const navbar = document.querySelector('.navbar-custom'); // Selecciona la barra de navegación
                // Si el clic no fue dentro de la navbar ni en un dropdown abierto, cierra todos los dropdowns
                if (!navbar.contains(event.target) && !event.target.closest('.dropdown-menu')) { // Agregado .closest para manejar clics dentro del dropdown
                        // Solo cerramos los dropdowns si están visibles
                    if (userSessionDropdown.style.display === 'block') userSessionDropdown.style.display = 'none';
                    if (portafolioDropdown.style.display === 'block') portafolioDropdown.style.display = 'none';
                    if (depositoDropdown.style.display === 'block') depositoDropdown.style.display = 'none';
                    if (cryptoTradeDropdown.style.display === 'block') cryptoTradeDropdown.style.display = 'none';
                    if (supportDropdown.style.display === 'block') supportDropdown.style.display = 'none';
                }
            });


            // Inicialización: Al cargar la página, mostramos el contenido principal y actualizamos la visibilidad de la navegación
            showMainContent();
            updateNavVisibility();
        });
    </script>
</body>
</html>